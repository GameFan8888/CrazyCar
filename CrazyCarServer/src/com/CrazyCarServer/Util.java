package com.CrazyCarServer;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class Util {
	public static class JDBC{
		// MySQL 8.0 以上版本 - JDBC 驱动名及数据库 URL
		static final String JDBC_DRIVER = "com.mysql.cj.jdbc.Driver";
		static final String DB_URL = "jdbc:mysql://localhost:3306/crazy_car?"
				+ "useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC";

		// 数据库的用户名与密码，需要根据自己的设置
		static final String USER = "root";
		static final String PASS = "164728";

		public static String ExecuteSelectString(String sql, String key) {
			System.out.println("ExecuteSelect sql = " + sql);
			Connection conn = null;
			Statement stmt = null;
			String resultStr = null;
			try {
				// 注册 JDBC 驱动
				Class.forName(JDBC_DRIVER);

				// 打开链接
				//System.out.println("连接数据库...");
				conn = DriverManager.getConnection(DB_URL, USER, PASS);

				// 执行查询
				//System.out.println(" 实例化Statement对象...");
				stmt = conn.createStatement();
				ResultSet rs = stmt.executeQuery(sql);

				// 展开结果集数据库
				while (rs.next()) {
					// 通过字段检索
					resultStr = rs.getString(key);
					System.out.println("ExecuteSelect : " + key + " = " + resultStr);
				}
				// 完成后关闭
				System.out.println("ExecuteSelect  Finish");
				rs.close();
				stmt.close();
				conn.close();
				return resultStr;
			} catch (SQLException se) {
				// 处理 JDBC 错误
				se.printStackTrace();
			} catch (Exception e) {
				// 处理 Class.forName 错误
				e.printStackTrace();
				return resultStr;
			} finally {
				// 关闭资源
				try {
					if (stmt != null)
						stmt.close();
				} catch (SQLException se2) {
				} // 什么都不做
				try {
					if (conn != null)
						conn.close();
				} catch (SQLException se) {
					se.printStackTrace();
				}
			}

			System.out.println("Goodbye!");
			return resultStr;
		}
		
		public static int ExecuteSelectInt(String sql, String key) {
			System.out.println("ExecuteSelect sql = " + sql);
			Connection conn = null;
			Statement stmt = null;
			int resultInt = -1;
			try {
				// 注册 JDBC 驱动
				Class.forName(JDBC_DRIVER);

				// 打开链接
				//System.out.println("连接数据库...");
				conn = DriverManager.getConnection(DB_URL, USER, PASS);

				// 执行查询
				//System.out.println(" 实例化Statement对象...");
				stmt = conn.createStatement();
				ResultSet rs = stmt.executeQuery(sql);

				// 展开结果集数据库
				while (rs.next()) {
					// 通过字段检索
					resultInt = rs.getInt(key);
					System.out.println("ExecuteSelect : " + key + " = " + resultInt);
				}
				// 完成后关闭
				System.out.println("ExecuteSelect  Finish");
				rs.close();
				stmt.close();
				conn.close();
				return resultInt;
			} catch (SQLException se) {
				// 处理 JDBC 错误
				se.printStackTrace();
			} catch (Exception e) {
				// 处理 Class.forName 错误
				e.printStackTrace();
				return resultInt;
			} finally {
				// 关闭资源
				try {
					if (stmt != null)
						stmt.close();
				} catch (SQLException se2) {
				} // 什么都不做
				try {
					if (conn != null)
						conn.close();
				} catch (SQLException se) {
					se.printStackTrace();
				}
			}

			System.out.println("Goodbye!");
			return resultInt;
		}
		
		public static List<Integer> ExecuteSelectAllInt(String sql, String key) {
			System.out.println("ExecuteSelect sql = " + sql);
			Connection conn = null;
			Statement stmt = null;
			List<Integer> resultList = new ArrayList<Integer>();
			try {
				// 注册 JDBC 驱动
				Class.forName(JDBC_DRIVER);

				// 打开链接
				//System.out.println("连接数据库...");
				conn = DriverManager.getConnection(DB_URL, USER, PASS);

				// 执行查询
				//System.out.println(" 实例化Statement对象...");
				stmt = conn.createStatement();
				ResultSet rs = stmt.executeQuery(sql);

				// 展开结果集数据库
				while (rs.next()) {
					// 通过字段检索
					resultList.add(rs.getInt(key));
					System.out.println("ExecuteSelect : " + key + " = " + rs.getInt(key));
				}
				// 完成后关闭
				System.out.println("ExecuteSelect  Finish");
				rs.close();
				stmt.close();
				conn.close();
				return resultList;
			} catch (SQLException se) {
				// 处理 JDBC 错误
				se.printStackTrace();
			} catch (Exception e) {
				// 处理 Class.forName 错误
				e.printStackTrace();
				return resultList;
			} finally {
				// 关闭资源
				try {
					if (stmt != null)
						stmt.close();
				} catch (SQLException se2) {
				} // 什么都不做
				try {
					if (conn != null)
						conn.close();
				} catch (SQLException se) {
					se.printStackTrace();
				}
			}

			System.out.println("Goodbye!");
			return resultList;
		}
		
		public static void ExecuteInsert(String sql) {
			Connection conn = null;
			System.out.println("ExecuteInsert sql = " + sql);	
			try {
				// 注册 JDBC 驱动
				Class.forName(JDBC_DRIVER);
				conn = DriverManager.getConnection(DB_URL, USER, PASS);

				PreparedStatement pst = conn.prepareStatement(sql);
	            pst.executeUpdate();
				System.out.println(" ExecuteInsert Finish " + pst);
				conn.close();
				return;
			} catch (SQLException se) {
				// 处理 JDBC 错误
				se.printStackTrace();
			} catch (Exception e) {
				// 处理 Class.forName 错误
				e.printStackTrace();
				return;
			} finally {
				// 关闭资源
				try {
					if (conn != null)
						conn.close();
				} catch (SQLException se) {
					se.printStackTrace();
				}
			}

			System.out.println("Goodbye!");
			return;
		}
	}
}
